#!/bin/bash

# Define windows array based on environment
{{ if or (contains "gov" .chezmoi.username ) (contains "nj" .chezmoi.username) -}}
WINDOWS=(
    "$HOME"
    "$HOME/.local/share/chezmoi"
    "$HOME/git/github.com/newjersey/aws-connect-ccm-platform"
    "$HOME/git/github.com/newjersey/innovation.nj.gov"
    "$HOME/git/github.com/newjersey/innovation-engineering"
    "$HOME/git/github.com/newjersey/innovation-engineering-blog"
    "$HOME/git/github.com/newjersey/innovation-shared-actions/"
)
{{ else }}
WINDOWS=(
    "$HOME"
    "$HOME/.local/share/chezmoi"
    "$HOME/git/github.com/jviall/bigpeach.club"
    "$HOME/git/github.com/jviall/rekordbox-bulk-edit/"
)
{{ end }}

# Check if 'ide' session already exists and exit if it does
if tmux has-session -t ide 2>/dev/null; then
    echo "Session 'ide' already exists."
    tmux attach-session -t ide
    exit 0
fi

# Create a new tmux session named 'ide' if it doesn't exist
tmux new-session -d -s ide -c "${WINDOWS[0]}"

for i in "${!WINDOWS[@]}"; do
    if [ $i -eq 0 ]; then
        # First window already exists, just configure it
        tmux split-window -h -t ide:0 -c "${WINDOWS[0]}"
        tmux split-window -v -t ide:0.1 -c "${WINDOWS[0]}"
    else
        tmux new-window -t ide:$i -c "${WINDOWS[$i]}"
        tmux send-keys -t ide:$i 'nvim' C-m
        tmux split-window -h -t ide:$i -c "${WINDOWS[$i]}"
        tmux split-window -v -t ide:$i.1 -c "${WINDOWS[$i]}"
    fi
done

tmux select-window -t ide:0
tmux attach-session -t ide
